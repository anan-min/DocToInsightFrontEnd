<div class="h-screen bg-gray-50 flex md:flex-row flex-col overflow-y-scroll">
  <!-- File Upload Section -->
  <div class="md:w-1/2 p-8">
    <div class="max-w-2xl mx-auto">
      <h1 class="text-4xl xl:text-5xl font-bold text-gray-900 mb-2">DocToInsight</h1>
      <p class="text-lg xl:text-xl text-gray-600 mb-8">Upload your documents for AI-powered analysis</p>

      <div class="bg-white rounded-lg shadow-md p-6">
        <p-toast />
        <p-fileupload name="myfile" [multiple]="false" maxFileSize="104857600" [auto]="false"
          (onSelect)="onSelectedFiles($event)">

          <ng-template #header let-files let-chooseCallback="chooseCallback" let-clearCallback="clearCallback"
            let-uploadCallback="uploadCallback">
            <div class="flex flex-col gap-4 w-full">
              <div class="flex flex-wrap justify-between items-center gap-2">
                <h3 class="text-lg xl:text-xl font-semibold text-gray-800">Upload Files</h3>
                <div class="flex flex-wrap gap-2  justify-start">
                  <button (click)="choose($event, chooseCallback)"
                    class="px-4 py-2 xl:px-6 xl:py-3 bg-blue-500 text-white text-sm xl:text-base rounded-lg hover:bg-blue-600 transition-colors flex items-center gap-2">
                    <i class="pi pi-upload"></i>
                    Choose Files
                  </button>
                  <button (click)="analyzeFile()" [disabled]="!files || files.length === 0 || isProcessing"
                    class="px-4 py-2 xl:px-6 xl:py-3 bg-green-500 text-white text-sm xl:text-base rounded-lg hover:bg-green-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2">
                    <i class="pi pi-cog" [class.pi-spin]="isProcessing"></i>
                    {{ isProcessing ? 'Analyzing...' : 'Analyze' }}
                  </button>

                  <button *ngIf="isProcessing" (click)="cancelAnalysis()"
                    class="px-4 py-2 xl:px-6 xl:py-3 bg-red-500 text-white text-sm xl:text-base rounded-lg hover:bg-red-600 transition-colors flex items-center gap-2">
                    <i class="pi pi-times"></i>
                    Cancel
                  </button>

                  <button *ngIf="!isProcessing && (task_id || results)" (click)="resetToInitialState()"
                    class="px-4 py-2 xl:px-6 xl:py-3 bg-gray-500 text-white text-sm xl:text-base rounded-lg hover:bg-gray-600 transition-colors flex items-center gap-2">
                    <i class="pi pi-refresh"></i>
                    Reset
                  </button>
                  <button (click)="clearCallback()" [disabled]="!files || files.length === 0"
                    class="px-4 py-2 xl:px-6 xl:py-3 bg-red-500 text-white text-sm xl:text-base rounded-lg hover:bg-red-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2">
                    <i class="pi pi-times"></i>
                    Clear
                  </button>
                </div>
              </div>
              <p *ngIf="files?.length > 0" class="text-sm xl:text-base text-gray-600">{{ formatSize(totalSize) }}</p>

              <!-- Processing Status -->
              <div *ngIf="isProcessing && !isUploading" class="bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4">
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-3">
                    <i class="pi pi-spin pi-cog text-blue-600"></i>
                    <div>
                      <p class="font-medium text-blue-900 text-sm xl:text-base">{{ statusMessage }}</p>
                      <p class="text-sm xl:text-base text-blue-700">Processing time: {{ formatTime(processingTime) }}
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </ng-template>

          <ng-template #content let-files let-uploadedFiles="uploadedFiles" let-removeFileCallback="removeFileCallback"
            let-removeUploadedFileCallback="removeUploadedFileCallback">
            <div class="space-y-6 mt-6">

              <!-- Pending Files -->
              <div *ngIf="files?.length > 0">
                <h4 class="text-md xl:text-lg font-medium text-gray-700 mb-3">Current File</h4>
                <div class="space-y-2">
                  <div *ngFor="let file of files; let i = index"
                    class="flex flex-col sm:flex-row sm:items-center sm:justify-between p-3 bg-white border border-gray-200 rounded-lg gap-3">
                    <div class="flex items-center gap-3 min-w-0 flex-1">
                      <i class="pi pi-file text-gray-900 text-xl flex-shrink-0"></i>
                      <div class="min-w-0 flex-1">
                        <p class="font-medium text-gray-900 text-sm xl:text-base truncate">{{ file.name }}</p>
                        <p class="text-sm xl:text-base text-gray-500">{{ formatSize(file.size) }}</p>
                      </div>
                    </div>
                    <div class="flex items-center justify-between sm:justify-end gap-2 flex-shrink-0">

                      <button (click)="onRemoveTemplatingFile($event, file, removeFileCallback, i)"
                        class="p-1 text-red-500 hover:bg-red-100 rounded flex-shrink-0">
                        <i class="pi pi-times"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Completed Files -->
              <div *ngIf="uploadedFiles?.length > 0">
                <h4 class="text-md xl:text-lg font-medium text-gray-700 mb-3">Completed Files</h4>
                <div class="space-y-2">
                  <div *ngFor="let file of uploadedFiles; let i = index"
                    class="flex flex-col sm:flex-row sm:items-center sm:justify-between p-3 bg-green-50 border border-green-200 rounded-lg gap-3">
                    <div class="flex items-center gap-3 min-w-0 flex-1">
                      <i class="pi pi-check-circle text-green-600 text-xl flex-shrink-0"></i>
                      <div class="min-w-0 flex-1">
                        <p class="font-medium text-gray-900 text-sm xl:text-base truncate">{{ file.name }}</p>
                        <p class="text-sm xl:text-base text-gray-500">{{ formatSize(file.size) }} • Analysis time: {{
                          formatTime(totalAnalysisTime) }}</p>
                      </div>
                    </div>
                    <div class="flex items-center justify-between sm:justify-end gap-2 flex-shrink-0">
                      <span
                        class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full whitespace-nowrap">Completed</span>
                      <button (click)="removeUploadedFileCallback(i)"
                        class="p-1 text-red-500 hover:bg-red-100 rounded flex-shrink-0">
                        <i class="pi pi-times"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </ng-template>

          <ng-template #file></ng-template>

          <ng-template #empty>
            <div
              class="border-2 border-dashed border-gray-300 rounded-lg p-12 text-center hover:border-blue-400 transition-colors">
              <i class="pi pi-cloud-upload text-6xl text-gray-400 mb-4"></i>
              <h4 class="text-lg font-medium text-gray-900 mb-2">Upload your documents</h4>
              <p class="text-gray-600 mb-4">Drag and drop files here, or click to browse</p>
              <p class="text-sm text-gray-500">Supports all file types • Single file • Max 100MB</p>
            </div>
          </ng-template>
        </p-fileupload>
      </div>
    </div>
  </div>

  <!-- Analysis Results Section -->
  <div class="md:w-1/2 bg-white border-l border-gray-200 p-8 h-full flex-1">
    <div class="max-w-2xl mx-auto">
      <h2 class="text-2xl xl:text-3xl font-bold text-gray-900 mb-6">Analysis Results</h2>

      <!-- Placeholder for different states -->
      <div *ngIf="!results && !isProcessing" class="text-center py-16">
        <i class="pi pi-chart-line text-6xl xl:text-7xl text-gray-300 mb-4"></i>
        <h3 class="text-lg xl:text-xl font-medium text-gray-700 mb-2">Ready for Analysis</h3>
        <p class="text-gray-500 text-base xl:text-lg">Upload and analyze files to see insights here</p>
      </div>

      <!-- Processing state -->
      <div *ngIf="isProcessing && !results" class="text-center py-16">
        <i class="pi pi-cog text-6xl xl:text-7xl text-gray-500 mb-4"></i>
        <h3 class="text-lg xl:text-xl font-medium text-gray-700 mb-2">Analyzing Document</h3>
        <p class="text-gray-600 text-base xl:text-lg">{{ statusMessage }}</p>
        <!-- <p class="text-blue-500 text-sm xl:text-base mt-2">Processing time: {{ formatTime(processingTime) }}</p> -->
      </div>

      <!-- Results display -->
      <div *ngIf="results" id="analysis-results-container" class="space-y-4">
        <!-- Analysis Summary -->
        <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
          <div class="flex items-center gap-2 mb-2">
            <i class="pi pi-check-circle text-green-600"></i>
            <h3 class="font-semibold text-green-900 text-base xl:text-lg">Analysis Complete</h3>
          </div>
          <p class="text-sm xl:text-base text-green-700">Document analysis completed successfully</p>
          <p class="text-sm xl:text-base text-green-600 mt-1 font-medium">⏱️ Total analysis time: {{
            formatTime(totalAnalysisTime) }}</p>
        </div>

        <p-accordion [multiple]="true">
          <p-accordionTab *ngFor="let item of results" [header]="item.requirement">
            <div *ngFor="let checklist of item.testchecklist" class="flex items-center gap-2 mb-3">
              <p-checkbox [(ngModel)]="selectedChecklist[item.requirement][checklist]" [binary]="true"></p-checkbox>
              <label class="text-sm xl:text-base text-gray-700 cursor-pointer flex-1">{{ checklist }}</label>
            </div>
          </p-accordionTab>
        </p-accordion>
      </div>
    </div>
  </div>
</div>